package DB;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class HandleGetFriendDB {
	private Connection conn;
	private String[] tokens;
	private Statement stmt;

	public HandleGetFriendDB(String[] tokens, Connection conn, Statement stmt) {
		this.tokens = tokens;
		String driver = "com.mysql.cj.jdbc.Driver";
		String url = "jdbc:mysql://127.0.0.1:3306/cs176bproject?";
		String sqlName = "root";
		String sqlPassword = "fujie19970";
		
		try {
			Class.forName(driver);
			System.out.println("Connecting to database server");
	
			this.conn =  DriverManager.getConnection(url, sqlName, sqlPassword);
			System.out.println("Connect Successful");
			this.stmt = conn.createStatement();	
		}catch(Exception e) {
			e.printStackTrace();
		}
	}
	
	@SuppressWarnings("finally")
	public String friendUserName() throws SQLException {
		String userName = "";
		try {
			
			for(int i = 0; i < tokens.length; i++) System.out.println(tokens[i]);
			
			String Aid_1 = tokens[1];
			String login = tokens[2];

	
			String sql_checkIfFriend  = "SELECT * FROM FriendStatus WHERE Aid_1 = '" + Aid_1 + "'"; 
			ResultSet rs21 = stmt.executeQuery(sql_checkIfFriend);
			while(rs21.next()) {
				if(rs21.getString("Aid_2").equals(login)) {
					String sql_getUserName = "SELECT * FROM ClientInfo WHERE Aid = '" + login + "'";
					ResultSet rs3 = stmt.executeQuery(sql_getUserName);
					rs3.next();
					userName = rs3.getString("UserName");
					//userListModel.addElement(rs3.getString("UserName"));
					rs3.close();
				}
			}
			rs21.close();
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			if(userName.equalsIgnoreCase("")) return "error";
			else return userName;
		}
	}
}
